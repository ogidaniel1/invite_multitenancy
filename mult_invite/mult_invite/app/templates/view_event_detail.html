{% extends "base.html" %}
{% block title %}{{ event.name }} — Event Details{% endblock %}

{% block content %}
<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="mb-1">{{ event.name }}</h3>
      <small class="text-muted">
        {{ event.start_time.strftime('%Y-%m-%d %H:%M') }} 
        — {{ event.location.name if event.location else "No location" }}
      </small>
      <div>
        <span class="badge 
          {% if event.status == 'upcoming' %}bg-success
          {% elif event.status == 'past' %}bg-secondary
          {% elif event.status == 'canceled' %}bg-danger
          {% else %}bg-warning{% endif %}">
          {{ event.status|capitalize }}
        </span>
      </div>
    </div>
    <a href="{{ url_for('inv.show_event_invitees', org_uuid=org.uuid) }}" class="btn btn-outline-secondary">
      ← Back to Events
    </a>
  </div>

  <!-- Search form -->
  <form class="row g-2 mb-3" method="get">
    <div class="col-sm-8">
      <input type="text" name="search" value="{{ search }}" class="form-control" placeholder="Search invitees by name, phone...">
    </div>
    <div class="col-sm-2">
      <button class="btn btn-primary w-100" type="submit">Search</button>
    </div>
    <div class="col-sm-2">
      <a href="{{ url_for('inv.view_event_detail', org_uuid=org.uuid, event_id=event.id) }}" class="btn btn-outline-secondary w-100">Reset</a>
    </div>
  </form>

  <!-- Invitees table -->
  <div class="card shadow-sm">
    <div class="card-header bg-light">
      <h5 class="mb-0">Invitees ({{ pagination.total }})</h5>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead class="table-secondary">
          <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Gender</th>
            <th>RSVP</th>
            <th>Attendance</th>
            <th>Confirmed At</th>
          </tr>
        </thead>
        <tbody>
        {% for link in invitees %}
          <tr>
            <td>{{ link.invitee.name }}</td>
            <td>{{ link.invitee.phone_number }}</td>
            <td>{{ link.invitee.email or '-' }}</td>
            <td>{{ link.invitee.gender or '-' }}</td>
            <td>
              {% if link.status %}
                <span class="badge bg-info text-dark">{{ link.status }}</span>
              {% else %}
                <span class="text-muted">Pending</span>
              {% endif %}
            </td>
            <td>
              {% if link.invitee.confirmed == "Present" %}
                <span class="badge bg-success">Present</span>
              {% elif link.invitee.confirmed == "Absent" %}
                <span class="badge bg-danger">Absent</span>
              {% else %}
                <span class="badge bg-secondary">Not Marked</span>
              {% endif %}
            </td>
            <td>
              {{ link.invitee.confirmation_date.strftime('%Y-%m-%d %H:%M') if link.invitee.confirmation_date else '-' }}
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="7" class="text-center text-muted">No invitees found for this event.</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  <nav class="mt-3">
    <ul class="pagination justify-content-center">
      {% if pagination.has_prev %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('inv.view_event_detail', org_uuid=org.uuid, event_id=event.id, page=pagination.prev_num, search=search) }}">Previous</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">Page {{ pagination.page }} of {{ pagination.pages or 1 }}</span>
      </li>

      {% if pagination.has_next %}
        <li class="page-item">
          <a class="page-link" href="{{ url_for('inv.view_event_detail', org_uuid=org.uuid, event_id=event.id, page=pagination.next_num, search=search) }}">Next</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}


