<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <title>Organization Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .organization-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .organization-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .organization-logo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .search-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
        }

        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }

        .btn-custom:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            color: white;
        }

        .flash-message {
            animation: slideIn 0.3s ease-in-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: none;
        }
    </style>
</head>
<!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-building me-2"></i>
                Organization Manager
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#" onclick="showListPage()">
                    <i class="fas fa-list me-1"></i>
                    Organizations
                </a>
                  <a class="nav-link active" href="/admin/management">
                    <i class="fas fa-users-cog me-1"></i>
                    Management
                </a>
                <a class="nav-link" href="{{ url_for('inv.register_organization') }}" onclick="showCreateForm()">
                    <i class="fas fa-plus me-1"></i>
                    Add New
                </a>
              <!-- <li> -->
                <a class="nav-link active" href="{{ url_for('inv.logout_super',org_uuid=org_uuid) }}">
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i> logout 
                </a>
            </div>
        </div>
    </nav>

<body>
    
    <!-- Flash Messages -->
    <div class="container mt-3">
        <div id="flash-messages">
            <!-- Flash messages will be inserted here -->
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Organizations List Page -->
        <div id="list-page" class="page-content">
            <!-- Search Header -->
            <div class="search-container">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h1 class="display-6 mb-0">
                                <i class="fas fa-building me-3"></i>
                                Organizations
                            </h1>
                            <p class="lead mb-0">Manage your organization registry</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <a href="{{ url_for('inv.register_organization') }}" onclick="showCreateForm()"
                                class="btn btn-light btn-lg">
                                <i class="fas fa-plus me-2"></i>
                                Add Organization
                            </a>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="input-group">
                                <span class="input-group-text bg-white">
                                    <i class="fas fa-search"></i>
                                </span>
                                <input type="text" id="search-input" class="form-control"
                                    placeholder="Search organizations...">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loading-spinner" class="text-center py-5 loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading organizations...</p>
            </div>

            <!-- Organizations Grid -->
            <div class="container py-4">
                <div id="organizations-grid" class="row">
                    <!-- Organizations will be loaded here -->
                </div>

                <div id="no-results" class="text-center py-5" style="display: none;">
                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No organizations found</h4>
                    <p class="text-muted">Try adjusting your search terms</p>
                </div>

                <div id="error-message" class="text-center py-5" style="display: none;">
                    <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
                    <h4 class="text-danger">Error Loading Organizations</h4>
                    <p class="text-muted">Please try refreshing the page</p>
                    <button class="btn btn-primary" onclick="loadOrganizations()">
                        <i class="fas fa-refresh me-2"></i>
                        Retry
                    </button>
                </div>
            </div>
        </div>

        <!-- Organization Form Page -->
        <div id="form-page" class="page-content" style="display: none;">
            <div class="container py-4">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card shadow">
                            <div class="card-header bg-primary text-white">
                                <h3 class="card-title mb-0">
                                    <i class="fas fa-building me-2"></i>
                                    <span id="form-title">Add Organization</span>
                                </h3>
                            </div>
                            <div class="card-body">
                                <form id="organization-form" enctype="multipart/form-data">
                                    <input type="hidden" id="org-id" name="id">

                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="mb-3">
                                                <label for="name" class="form-label">
                                                    Organization Name *
                                                </label>
                                                <input type="text" class="form-control" id="name" name="name" required>
                                            </div>
                                            <div class="mb-3">
                                                <label for="slug" class="form-label">
                                                    Slug *
                                                </label>
                                                <input type="text" class="form-control" id="slug" name="slug" required>
                                                <div class="form-text">URL-friendly identifier (auto-generated from
                                                    name)</div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="logo" class="form-label">Logo</label>
                                                <input type="file" class="form-control" id="logo" name="logo_url"
                                                    accept="image/*">
                                                <div class="form-text">PNG, JPEG, GIF, or JPG</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="current-logo" style="display: none;" class="mb-3">
                                        <label class="form-label">Current Logo</label>
                                        <div>
                                            <img id="current-logo-img" src="" alt="Current logo"
                                                class="organization-logo">
                                        </div>
                                    </div>

                                    <div class="d-flex gap-2">
                                        <button type="submit" class="btn btn-custom" id="submit-btn">
                                            <i class="fas fa-save me-2"></i>
                                            <span id="submit-text">Create Organization</span>
                                        </button>
                                        <button type="button" class="btn btn-secondary" onclick="showListPage()">
                                            <i class="fas fa-times me-2"></i>
                                            Cancel
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Organization Detail Page -->
        <div id="detail-page" class="page-content" style="display: none;">
            <div class="container py-4">
                <div class="row">
                    <div class="col-md-8">
                        <div class="card shadow">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-4">
                                    <div id="detail-logo" class="me-3">
                                        <!-- Logo will be inserted here -->
                                    </div>
                                    <div>
                                        <h2 id="detail-name" class="mb-1"></h2>
                                        <p class="text-muted mb-0">
                                            <i class="fas fa-link me-1"></i>

                                            <a id="invitees-link" class="nav-link">
                                                <i class="bi bi-speedometer2"></i>
                                                <span id="detail-slug"></span>
                                            </a>

                                        </p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <p><strong>ID:</strong> <span id="detail-id"></span></p>
                                        <p><strong>UUID:</strong> <span id="detail-uuid"></span></p>
                                                      
                                            
                                    </div>

                                    <div class="col-sm-6">
                                        <p><strong>Created:</strong> <span id="detail-created"></span></p>
                                        <p><strong>Locations:</strong> <span id="detail-locations">0 active</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card shadow">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">

                                    <!-- add org admin -->
                                    
                                <button class="btn btn-custom" onclick="addOrganizationAdmin()">
                                    <i class="fas fa-user-plus me-2"></i>
                                    Add Organization Admin
                                </button>

                                  <button class="btn btn-primary" onclick="editOrganization()">
                                        <i class="fas fa-edit me-2"></i>
                                        Edit Organization
                                    </button>
                                    <button class="btn btn-danger" onclick="confirmDelete()">
                                        <i class="fas fa-trash me-2"></i>
                                        Delete Organization
                                    </button>
                                    <button class="btn btn-secondary" onclick="showListPage()">
                                        <i class="fas fa-arrow-left me-2"></i>
                                        Back to List
                                    </button>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-trash me-2"></i>
                        Confirm Delete
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this organization?</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong id="delete-org-name"></strong> will be permanently deleted.
                        This action cannot be undone.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteOrganization()" id="delete-btn">
                        <i class="fas fa-trash me-2"></i>
                        Delete Organization
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>


        // Global variables
        let organizations = [];
        let currentOrganization = null;
        let deleteModal = null;
        let filteredOrganizations = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function () {
            deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            loadOrganizations();
            setupSearch();
            setupSlugGeneration();
        });

        // API Base URL - adjust according to your Flask app

        // const API_BASE = 'http://127.0.0.1:5000';
        const API_BASE = `${window.location.protocol}//${window.location.host}`;


        // Load all organizations from API
        async function loadOrganizations() {
            showLoading(true);
            hideError();

            try {
                const response = await fetch(`${API_BASE}/api/organizations`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                organizations = await response.json();
                filteredOrganizations = [...organizations];
                renderOrganizations(filteredOrganizations);
                showLoading(false);
            } catch (error) {
                console.error('Error loading organizations:', error);
                showError();
                showLoading(false);
                showFlashMessage('Error loading organizations. Please try again.', 'error');
            }
        }

        // Load single organization from API
        async function loadOrganization(id) {
            try {
                const response = await fetch(`${API_BASE}/api/organization/${id}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('Error loading organization:', error);
                showFlashMessage('Error loading organization details.', 'error');
                return null;
            }
        }

        // Create or update organization
        async function saveOrganization(formData, isEdit = false, orgId = null) {
            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.innerHTML;

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';


                let url, method;
                if (isEdit) {
                    url = `${API_BASE}/organization/${orgId}/edit`;
                    method = 'POST';

                } else {
                    url = `${API_BASE}/add_organization`;
                    method = 'POST';
                }

                // Get CSRF token from meta tag
                const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
                formData.append("csrf_token", csrfToken);

                const response = await fetch(url, {
                    method: method,
                    body: formData
                });

                if (response.redirected) {
                    // Handle Flask redirects - extract flash messages if possible
                    window.location.href = response.url;
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Success - reload organizations and show list
                await loadOrganizations();
                showListPage();

                const action = isEdit ? 'updated' : 'created';
                showFlashMessage(`Organization ${action} successfully!`, 'success');

            } catch (error) {
                console.error('Error saving organization:', error);
                showFlashMessage(`Error ${isEdit ? 'updating' : 'creating'} organization.`, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }

        // Delete organization

        function getCsrfToken() {
            return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        }
        async function deleteOrganizationAPI(id) {
            const deleteBtn = document.getElementById('delete-btn');
            const originalText = deleteBtn.innerHTML;

            try {
                deleteBtn.disabled = true;
                deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Deleting...';

                const response = await fetch(`${API_BASE}/api/organization/${id}/delete`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCsrfToken()
                    }
                });


                const result = await response.json();

                if (result.success) {
                    showFlashMessage(result.message, 'success');
                    await loadOrganizations();
                    showListPage();
                } else {
                    showFlashMessage(result.message, 'error');
                }

            } catch (error) {
                console.error('Error deleting organization:', error);
                showFlashMessage('Error deleting organization.', 'error');
            } finally {
                deleteBtn.disabled = false;
                deleteBtn.innerHTML = originalText;
                deleteModal.hide();
            }
        }


        // Render organizations grid here
       
        function renderOrganizations(orgs) {
            const grid = document.getElementById('organizations-grid');
            const noResults = document.getElementById('no-results');

            if (orgs.length === 0) {
                grid.innerHTML = '';
                noResults.style.display = 'block';
                return;
            }

            noResults.style.display = 'none';
            grid.innerHTML = `
        <div class="row">
            ${orgs.map(org => `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card organization-card h-100 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                ${org.logo_url ?
                    `<img src="/static/images/${org.logo_url}" alt="${org.name} logo" class="organization-logo me-3">` :
                    `<div class="organization-logo me-3 bg-primary d-flex align-items-center justify-content-center text-white">
                                        <i class="fas fa-building"></i>
                                    </div>`
                }
                                <div class="flex-grow-1">
                                    <h5 class="card-title mb-1">${escapeHtml(org.name)}</h5>
                                   <small class="text-muted">${escapeHtml(org.slug)} </small>
                                </div>
                            </div>
                            <p class="text-muted small mb-3">
                                <i class="fas fa-calendar me-1"></i>
                                Created: ${formatDate(org.created_at)}
                            </p>
                            <p class="text-muted small mb-3">
                                <i class="fas fa-map-marker-alt me-1"></i>
                                Locations: ${org.active_locations_count || 0} active
                            </p>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm flex-fill"
                                        onclick="viewOrganization(${org.id})">
                                    <i class="fas fa-eye me-1"></i>
                                    View
                                </button>
                                <button class="btn btn-outline-secondary btn-sm"
                                        onclick="editOrganizationById(${org.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
        }

        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('search-input');
            let searchTimeout;

            searchInput.addEventListener('input', function () {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = this.value.toLowerCase().trim();

                    if (searchTerm === '') {
                        filteredOrganizations = [...organizations];
                    } else {
                        filteredOrganizations = organizations.filter(org =>
                            org.name.toLowerCase().includes(searchTerm) ||
                            org.slug.toLowerCase().includes(searchTerm)
                        );
                    }

                    renderOrganizations(filteredOrganizations);
                }, 300);
            });
        }


        // create admin organization

        function addOrganizationAdmin() {
            if (!currentOrganization) return;

            // Navigate to the Flask route for adding admin
            window.location.href = `/${currentOrganization.uuid}/register_admin`;
        }


        // Setup automatic slug generation
        function setupSlugGeneration() {
            const nameInput = document.getElementById('name');
            const slugInput = document.getElementById('slug');

            nameInput.addEventListener('input', function () {
                // Only auto-generate slug if it's empty or matches the previous name
                if (!slugInput.value || slugInput.dataset.autoGenerated === 'true') {
                    slugInput.value = createSlug(this.value);
                    slugInput.dataset.autoGenerated = 'true';
                }
            });

            slugInput.addEventListener('input', function () {
                // Mark as manually edited if user types in slug field
                this.dataset.autoGenerated = 'false';
            });
        }

        // Show different pages
        function showListPage() {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('list-page').style.display = 'block';

            // Apply current search filter
            const searchInput = document.getElementById('search-input');
            if (searchInput.value) {
                searchInput.dispatchEvent(new Event('input'));
            }
        }

        function showCreateForm() {
            document.getElementById('form-title').textContent = 'Add Organization';
            document.getElementById('submit-text').textContent = 'Create Organization';
            document.getElementById('organization-form').reset();
            document.getElementById('org-id').value = '';
            document.getElementById('current-logo').style.display = 'none';

            // Reset slug auto-generation
            document.getElementById('slug').dataset.autoGenerated = 'true';

            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('form-page').style.display = 'block';
        }

        function showDetailPage() {
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('detail-page').style.display = 'block';
        }

        // View organization details
        async function viewOrganization(id) {
            const org = await loadOrganization(id);
            if (!org) return;

            currentOrganization = org;

            document.getElementById('detail-name').textContent = org.name;
            document.getElementById('detail-slug').textContent = org.slug;
            document.getElementById('detail-id').textContent = org.id;
            document.getElementById('detail-uuid').textContent = org.uuid;
            document.getElementById('detail-created').textContent = formatDate(org.created_at);
            document.getElementById('detail-locations').textContent = `${org.active_locations_count || 0} active`;
           
            // FIX: Build correct invitees URL
            let inviteesUrl = "/" + org.uuid + "/invitees";
            document.getElementById("invitees-link").href = inviteesUrl;

            const logoContainer = document.getElementById('detail-logo');
            if (org.logo_url) {
                logoContainer.innerHTML = `<img src="/static/images/${org.logo_url}" alt="${org.name} logo" class="organization-logo">`;
            } else {
                logoContainer.innerHTML = `<div class="organization-logo bg-primary d-flex align-items-center justify-content-center text-white">
                    <i class="fas fa-building"></i>
                </div>`;
            }

            showDetailPage();
        }

        // initialize
        document.addEventListener('DOMContentLoaded', function(){
            renderOrganizations(filteredOrganizations);
            setupSearch();
        });

        

        // Edit organization
        function editOrganization() {
            if (!currentOrganization) return;
            editOrganizationById(currentOrganization.id);

        }

        async function editOrganizationById(id) {
            const org = await loadOrganization(id);
            if (!org) return;

            currentOrganization = org;

            document.getElementById('form-title').textContent = 'Edit Organization';
            document.getElementById('submit-text').textContent = 'Update Organization';
            document.getElementById('org-id').value = org.id;
            document.getElementById('name').value = org.name;
            document.getElementById('slug').value = org.slug;

            // Mark slug as manually set
            document.getElementById('slug').dataset.autoGenerated = 'false';

            if (org.logo_url) {
                document.getElementById('current-logo').style.display = 'block';
                document.getElementById('current-logo-img').src = `/static/images/${org.logo_url}`;
            } else {
                document.getElementById('current-logo').style.display = 'none';
            }

            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('form-page').style.display = 'block';
        }

        // Form submission
        document.getElementById('organization-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const id = document.getElementById('org-id').value;

            if (id) {
                // Update existing organization
                saveOrganization(formData, true, id);
            } else {
                // Create new organization
                saveOrganization(formData, false);
            }
        });

        // Delete confirmation
        function confirmDelete() {
            if (!currentOrganization) return;

            document.getElementById('delete-org-name').textContent = currentOrganization.name;
            deleteModal.show();
        }

        function deleteOrganization() {
            if (!currentOrganization) return;
            deleteOrganizationAPI(currentOrganization.id);
        }

        // UI Helper functions
        function showLoading(show) {
            const spinner = document.getElementById('loading-spinner');
            const grid = document.getElementById('organizations-grid');

            if (show) {
                spinner.style.display = 'block';
                grid.style.display = 'none';
            } else {
                spinner.style.display = 'none';
                grid.style.display = 'block';
            }
        }

        function showError() {
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('organizations-grid').style.display = 'none';
            document.getElementById('no-results').style.display = 'none';
        }

        function hideError() {
            document.getElementById('error-message').style.display = 'none';
        }

        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return 'Unknown';

            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function createSlug(name) {
            return name.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showFlashMessage(message, type) {
            const flashContainer = document.getElementById('flash-messages');
            const alertClass = type === 'success' ? 'alert-success' :
                type === 'error' ? 'alert-danger' : 'alert-info';

            const flashMessage = document.createElement('div');
            flashMessage.className = `alert ${alertClass} alert-dismissible fade show flash-message`;
            flashMessage.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                ${escapeHtml(message)}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            flashContainer.appendChild(flashMessage);

            // Auto-dismiss after 5 seconds
            setTimeout(() => {
                if (flashMessage.parentNode) {
                    flashMessage.classList.remove('show');
                    setTimeout(() => {
                        if (flashMessage.parentNode) {
                            flashContainer.removeChild(flashMessage);
                        }
                    }, 150);
                }
            }, 5000);
        }

        // bulk delete

        $('#bulkDeleteBtn').on('click', function (e) {
    e.preventDefault();
    const selectedIds = $("input[name='org_ids']:checked").map(function () {
        return $(this).val();
    }).get();

    if (!selectedIds.length) {
        alert("Please select at least one organization.");
        return;
    }

    $.post('/organizations/bulk_action', {
        action: 'delete',
        org_ids: selectedIds
    }).done(function (response) {
        location.reload();
    }).fail(function () {
        alert('An error occurred.');
    });
});

    </script>
</body>

</html>